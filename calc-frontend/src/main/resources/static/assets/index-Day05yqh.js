import{r as o,j as e,u as z,A as Re,T as Fe,B as p,L as R,F as We,a as j,b as S,M as Ue,c as Be,d as I,e as K,S as $,f as we,C as Z,g as H,h as v,i as D,k as te,I as re,l as se,D as ue,m as he,n as me,o as xe,p as V,q as le,s as ke,P as J,t as ne,v as ae,w as Ae,x as F,y as f,z as oe,E as X,G as _,H as Oe,J as ie,K as Pe,N as ze,O as $e,Q as pe,R as fe,U as be,V as ee,W as Ve,X as qe,Y as Me,Z as _e,_ as He,$ as Je,a0 as ye,a1 as ve,a2 as Ce,a3 as Ge,a4 as Ye,a5 as Ke,a6 as M,a7 as Xe}from"./vendor-BawIlNoU.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))l(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&l(a)}).observe(document,{childList:!0,subtree:!0});function i(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function l(n){if(n.ep)return;n.ep=!0;const s=i(n);fetch(n.href,s)}})();async function ce(t,r={}){const i=u=>u.replace(/[\r\n]+/g,"").trim(),l=i(t),n={};if(r.headers)for(const[u,x]of Object.entries(r.headers))n[u]=i(x);let s=r.body;typeof s=="string"&&(s=i(s));const a={...r,headers:n,body:s};console.log("--- FETCH REQUEST ---"),console.log("URL:",l),console.log("Options:",a);const c=await fetch(l,a);return console.log("--- FETCH RESPONSE ---"),console.log("Status:",c.status),console.log("Headers:",[...c.headers.entries()]),c}const Ne=o.createContext(),Ze=({children:t})=>{const[r,i]=o.useState(null),[l,n]=o.useState(!0);o.useEffect(()=>{const x=localStorage.getItem("token");x?s(x):n(!1)},[]);const s=async x=>{try{const d=await ce("/api/auth/me",{method:"GET",headers:{Authorization:`Bearer ${x}`,"Content-Type":"application/json"}});if(d.ok){const m=await d.json();i(m.data)}else localStorage.removeItem("token"),i(null)}catch(d){console.error("Failed to fetch user profile:",d),localStorage.removeItem("token"),i(null)}finally{n(!1)}},a=async(x,d)=>{try{const m=await ce("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:x,password:d})});if(!m.ok)return{success:!1,message:(await m.json()).message||"Invalid email or password"};const g=await m.json();return localStorage.setItem("token",g.data.token),await s(g.data.token),{success:!0}}catch(m){return{success:!1,message:m.message||"Login failed. Please try again."}}},c=async x=>{try{const d=await ce("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(x)});if(!d.ok){const m=await d.json();return m.errors&&Array.isArray(m.errors)?{success:!1,message:m.errors.map(b=>b.description||b.errorCode).join(", ")}:{success:!1,message:m.message||"Registration failed"}}return{success:!0}}catch(d){return{success:!1,message:d.message||"Registration error. Please check your data."}}},u=()=>{localStorage.removeItem("token"),i(null)};return e.jsx(Ne.Provider,{value:{user:r,loading:l,login:a,logout:u,register:c},children:t})},B=()=>o.useContext(Ne);function Qe(){const{user:t,setUser:r,setTokens:i}=B(),l=z(),[n,s]=o.useState(null),a=d=>s(d.currentTarget),c=()=>s(null),u=async()=>{try{const d=localStorage.getItem("token");if(!d){console.warn("No JWT token found for logout"),i(null),r(null),l("/",{replace:!0}),window.location.reload(),c();return}(await fetch("/api/auth/logout",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`}})).ok?(localStorage.removeItem("token"),i(null),r(null),window.location.href="http://localhost/"):console.error("Logout failed")}catch(d){console.error("Logout error:",d)}finally{c()}},x=e.jsxs(e.Fragment,{children:[e.jsx(I,{onClick:()=>{l("/auth?type=login"),c()},children:"Login"}),e.jsx(I,{onClick:()=>{l("/auth?type=register"),c()},children:"Register"})]});return e.jsx(Re,{position:"static",color:"primary",elevation:3,children:e.jsxs(Fe,{sx:{justifyContent:"space-between"},children:[e.jsxs(p,{display:"flex",alignItems:"center",component:R,to:"/",sx:{textDecoration:"none",color:"inherit"},children:[e.jsx(We,{size:24,style:{marginRight:8}}),e.jsx(j,{variant:"h6",component:"div",children:"Travel Insurance"})]}),e.jsxs(p,{sx:{display:{xs:"none",md:"flex"},alignItems:"center"},gap:2,children:[e.jsx(S,{component:R,to:"/",color:"inherit",children:"Home"}),e.jsx(S,{component:R,to:"/countries",color:"inherit",children:"Countries"}),t?e.jsxs(e.Fragment,{children:[e.jsx(S,{component:R,to:"/profile",color:"inherit",children:"Profile"}),e.jsx(S,{component:R,to:"/insurance",color:"inherit",children:"Insurance"}),e.jsx(S,{onClick:u,color:"inherit",variant:"outlined",size:"small",sx:{ml:2},children:"Logout"})]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{onClick:a,color:"inherit",startIcon:e.jsx(Ue,{}),children:"Account"}),e.jsx(Be,{anchorEl:n,open:!!n,onClose:c,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:x})]})]})]})})}function et(){return e.jsxs(p,{component:"footer",sx:{py:2,px:3,mt:"auto",backgroundColor:"primary.main",color:"primary.contrastText",textAlign:"center",display:"flex",flexDirection:{xs:"column",sm:"row"},alignItems:"center",justifyContent:"space-between",gap:2},children:[e.jsxs(j,{variant:"body2",sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx("span",{role:"img","aria-label":"globe",style:{marginRight:6},children:"ðŸŒ"}),"2024 Travel Insurance Inc."]}),e.jsxs(p,{children:[e.jsx(K,{component:R,to:"/countries",underline:"hover",color:"inherit",sx:{mx:1},children:"Countries Info"}),e.jsx(K,{href:"#",underline:"hover",color:"inherit",sx:{mx:1},children:"Privacy"}),e.jsx(K,{href:"#",underline:"hover",color:"inherit",sx:{mx:1},children:"Terms"})]})]})}function tt({children:t}){return e.jsxs(p,{sx:{display:"flex",flexDirection:"column",minHeight:"100vh",bgcolor:"background.default",color:"text.primary"},children:[e.jsx(Qe,{}),e.jsx(p,{component:"main",sx:{flexGrow:1,p:{xs:2,sm:3}},children:t}),e.jsx(et,{})]})}function rt(){const{user:t}=B();return e.jsxs(p,{sx:{textAlign:"center",py:8,px:2},children:[e.jsx(j,{variant:"h2",component:"h1",gutterBottom:!0,children:"Travel with Confidence"}),e.jsx(j,{variant:"h6",color:"text.secondary",mb:4,children:"Get comprehensive travel insurance coverage for your next adventure"}),e.jsxs($,{spacing:2,direction:{xs:"column",sm:"row"},justifyContent:"center",mb:6,children:[t?e.jsx(S,{component:R,to:"/insurance",variant:"contained",size:"large",children:"Get Insurance Now"}):e.jsx(S,{component:R,to:"/auth?type=register",variant:"contained",size:"large",children:"Get Started"}),e.jsx(S,{component:R,to:"/countries",variant:"outlined",size:"large",children:"Explore Countries"})]}),e.jsxs(p,{display:"flex",justifyContent:"center",gap:6,flexWrap:"wrap",children:[e.jsxs(p,{maxWidth:280,children:[e.jsx(j,{variant:"h5",gutterBottom:!0,children:"Comprehensive Coverage"}),e.jsx(j,{children:"Medical, trip cancellation, baggage loss, and more"})]}),e.jsxs(p,{maxWidth:280,children:[e.jsx(j,{variant:"h5",gutterBottom:!0,children:"24/7 Support"}),e.jsx(j,{children:"Assistance wherever you are in the world"})]}),e.jsxs(p,{maxWidth:280,children:[e.jsx(j,{variant:"h5",gutterBottom:!0,children:"Easy Claims"}),e.jsx(j,{children:"Simple online claims process"})]})]})]})}function st(){var m;const[t,r]=o.useState(""),[i,l]=o.useState(""),[n,s]=o.useState(""),{login:a}=B(),c=z(),x=((m=we().state)==null?void 0:m.from)||"/insurance",d=async g=>{g.preventDefault(),s("");const b=await a(t,i);b.success?c(x):s(b.message)};return e.jsx(p,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",bgcolor:"#f5f5f5",p:2,children:e.jsx(Z,{sx:{minWidth:360,boxShadow:3},children:e.jsxs(H,{children:[e.jsx(j,{variant:"h5",gutterBottom:!0,align:"center",children:"Login"}),e.jsxs("form",{onSubmit:d,noValidate:!0,children:[e.jsx(v,{label:"Email",type:"email",value:t,onChange:g=>r(g.target.value),fullWidth:!0,margin:"normal",required:!0,autoFocus:!0}),e.jsx(v,{label:"Password",type:"password",value:i,onChange:g=>l(g.target.value),fullWidth:!0,margin:"normal",required:!0}),n&&e.jsx(D,{severity:"error",sx:{mt:2},children:n}),e.jsx(S,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,sx:{mt:3},children:"Login"})]})]})})})}function nt(){const[t,r]=o.useState({firstName:"",lastName:"",email:"",password:"",birthDate:"",gender:""}),[i,l]=o.useState(""),{register:n}=B(),s=z(),a=u=>{const{name:x,value:d}=u.target;r(m=>({...m,[x]:d}))},c=async u=>{u.preventDefault(),l("");const x=await n(t);x.success?s("/auth?type=login"):l(x.message)};return e.jsx(p,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",bgcolor:"#f0f2f5",p:2,children:e.jsx(Z,{sx:{minWidth:400,boxShadow:3},children:e.jsxs(H,{children:[e.jsx(j,{variant:"h5",gutterBottom:!0,align:"center",children:"Register"}),e.jsxs("form",{onSubmit:c,noValidate:!0,children:[e.jsx(v,{label:"First Name",name:"firstName",value:t.firstName,onChange:a,fullWidth:!0,margin:"normal",required:!0,autoFocus:!0}),e.jsx(v,{label:"Last Name",name:"lastName",value:t.lastName,onChange:a,fullWidth:!0,margin:"normal",required:!0}),e.jsx(v,{label:"Email",name:"email",type:"email",value:t.email,onChange:a,fullWidth:!0,margin:"normal",required:!0}),e.jsx(v,{label:"Password",name:"password",type:"password",value:t.password,onChange:a,fullWidth:!0,margin:"normal",required:!0}),e.jsx(v,{label:"Birth Date",name:"birthDate",type:"date",value:t.birthDate,onChange:a,fullWidth:!0,margin:"normal",required:!0,InputLabelProps:{shrink:!0}}),e.jsxs(te,{fullWidth:!0,margin:"normal",required:!0,children:[e.jsx(re,{id:"gender-label",children:"Gender"}),e.jsxs(se,{labelId:"gender-label",name:"gender",value:t.gender,label:"Gender",onChange:a,children:[e.jsx(I,{value:"",children:e.jsx("em",{children:"Select gender"})}),e.jsx(I,{value:"Male",children:"Male"}),e.jsx(I,{value:"Female",children:"Female"})]})]}),i&&e.jsx(D,{severity:"error",sx:{mt:2},children:i}),e.jsx(S,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,sx:{mt:3},children:"Register"})]})]})})})}function at(){const t=we(),r=z(),l=new URLSearchParams(t.search).get("type")||"login";return o.useEffect(()=>{["login","register"].includes(l)||r("/auth?type=login",{replace:!0})},[l,r]),e.jsxs(p,{maxWidth:400,mx:"auto",mt:6,p:3,boxShadow:3,borderRadius:2,bgcolor:"background.paper",children:[l==="login"?e.jsx(st,{}):e.jsx(nt,{}),e.jsx(j,{mt:3,textAlign:"center",variant:"body2",color:"text.secondary",children:l==="login"?e.jsxs(e.Fragment,{children:["Don't have an account? ",e.jsx(K,{component:R,to:"/auth?type=register",children:"Register"})]}):e.jsxs(e.Fragment,{children:["Already have an account? ",e.jsx(K,{component:R,to:"/auth?type=login",children:"Login"})]})})]})}function ot({open:t,onClose:r,onConfirm:i}){const[l,n]=o.useState(""),[s,a]=o.useState(""),[c,u]=o.useState(!1),x=async()=>{if(a(""),!l){a("Please enter your password");return}u(!0);try{await i(l)}catch(m){a(m.message||"Password confirmation failed")}finally{u(!1)}},d=()=>{n(""),a(""),r()};return e.jsxs(ue,{open:t,onClose:d,children:[e.jsx(he,{children:"Confirm Profile Deletion"}),e.jsxs(me,{children:[e.jsx(v,{label:"Enter your password",type:"password",fullWidth:!0,value:l,onChange:m=>n(m.target.value),autoFocus:!0,disabled:c,margin:"dense"}),s&&e.jsx(D,{severity:"error",sx:{mt:2},children:s})]}),e.jsxs(xe,{children:[e.jsx(S,{onClick:d,disabled:c,children:"Cancel"}),e.jsx(S,{onClick:x,color:"error",variant:"contained",disabled:c,children:c?e.jsx(V,{size:24,color:"inherit"}):"Delete"})]})]})}function it({userData:t}){const[r,i]=o.useState({firstName:"",lastName:"",email:"",birthDate:"",gender:"",personCode:""}),[l,n]=o.useState(!1),[s,a]=o.useState("");o.useEffect(()=>{t&&i({firstName:t.firstName||"",lastName:t.lastName||"",email:t.email||"",birthDate:t.birthDate||"",gender:t.gender||"",personCode:t.personCode||""})},[t]);const c=x=>{const{name:d,value:m}=x.target;i(g=>({...g,[d]:m}))},u=async x=>{if(x.preventDefault(),a(""),n(!1),console.log("Submitting formData:",r),!r.firstName.trim()||!r.lastName.trim()){a("First Name and Last Name cannot be empty");return}try{const d=await fetch("/api/auth/update",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(r)});if(d.ok)n(!0),setTimeout(()=>n(!1),3e3);else{const m=await d.json();if(m.errors&&Array.isArray(m.errors)){const g=m.errors.map(b=>b.description||b.errorCode).join(", ");a(g)}else a(m.message||"Failed to update profile")}}catch{a("An unexpected error occurred. Please try again.")}};return e.jsx(p,{children:e.jsx(Z,{sx:{minWidth:400,boxShadow:3},children:e.jsxs(H,{children:[e.jsx(j,{variant:"h5",gutterBottom:!0,align:"center",children:"Profile"}),e.jsxs("form",{onSubmit:u,noValidate:!0,children:[e.jsx(v,{label:"First Name",name:"firstName",value:r.firstName,onChange:c,fullWidth:!0,margin:"normal",required:!0,inputProps:{maxLength:15,pattern:"^[A-Za-z -]+$"}}),e.jsx(v,{label:"Last Name",name:"lastName",value:r.lastName,onChange:c,fullWidth:!0,margin:"normal",required:!0,inputProps:{maxLength:15,pattern:"^[A-Za-z -]+$"}}),e.jsx(v,{label:"Email",name:"email",type:"email",value:r.email,onChange:c,fullWidth:!0,margin:"normal",required:!0}),e.jsx(v,{label:"Birth Date",name:"birthDate",type:"date",value:r.birthDate,onChange:c,fullWidth:!0,margin:"normal",InputLabelProps:{shrink:!0},required:!0}),e.jsx(v,{label:"Gender",name:"gender",value:r.gender,onChange:c,fullWidth:!0,margin:"normal",placeholder:"Male / Female / Other"}),e.jsx(v,{label:"Person Code",name:"personCode",value:r.personCode,onChange:c,fullWidth:!0,margin:"normal",InputProps:{readOnly:!0},placeholder:"X-12345"}),e.jsxs($,{direction:"row",spacing:1,mt:2,mb:2,children:[t.roles&&Array.from(t.roles).map(x=>e.jsx(le,{label:x,color:"primary"},x)),t.isEnabled&&e.jsx(le,{label:"Enabled",color:"success"}),t.blackListed&&e.jsx(le,{label:"Blacklisted",color:"error"})]}),t.personPremium&&e.jsxs(j,{variant:"subtitle2",color:"text.secondary",children:["Premium: ",t.personPremium]}),l&&e.jsx(D,{severity:"success",sx:{mt:2},children:"Profile updated successfully!"}),s&&e.jsx(D,{severity:"error",sx:{mt:2},children:s}),e.jsx(S,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,sx:{mt:3},children:"Update Profile"})]})]})})})}function lt({userData:t,loadingUser:r,error:i}){return r?e.jsxs(p,{textAlign:"center",mt:6,children:[e.jsx(V,{}),e.jsx(j,{mt:2,children:"Loading profile data..."})]}):i?e.jsx(p,{mt:6,children:e.jsx(D,{severity:"error",children:i})}):e.jsxs(e.Fragment,{children:[e.jsx(j,{variant:"h4",mb:3,children:"Your Profile"}),t?e.jsx(it,{userData:t}):e.jsx(j,{children:"No profile data available."})]})}function ct({agreements:t}){return!t||t.length===0?e.jsx(j,{children:"No agreements found."}):e.jsx(ke,{children:t.map(r=>e.jsxs(J,{sx:{mb:2,p:2},children:[e.jsxs(j,{variant:"subtitle1",gutterBottom:!0,children:["Agreement UUID: ",r.uuid]}),e.jsxs(j,{children:["Date From: ",r.agreementDateFrom&&new Date(r.agreementDateFrom).toLocaleString()]}),e.jsxs(j,{children:["Date To: ",r.agreementDateTo&&new Date(r.agreementDateTo).toLocaleString()]}),e.jsxs(j,{children:["Countries: ",r.countriesToVisit&&r.countriesToVisit.join(", ")]}),e.jsxs(j,{children:["Risks: ",r.selectedRisks&&r.selectedRisks.join(", ")]})]},r.uuid))})}function dt(){var m;const{user:t}=B(),[r,i]=o.useState([]),[l,n]=o.useState(!1),[s,a]=o.useState(""),[c,u]=o.useState(""),x=(m=t==null?void 0:t.roles)==null?void 0:m.includes("ROLE_ADMIN"),d=async(g="")=>{n(!0),a("");try{let b="/api/agreement/all";g&&x&&(b=`/api/agreement/find?uuid=${encodeURIComponent(g)}`);const y=await fetch(b,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),C=await y.json();if(y.ok){let h=C.data;h&&!Array.isArray(h)&&(h=[h]),i(h||[])}else a(C.message||"Failed to load agreements")}catch{a("Network error loading agreements")}finally{n(!1)}};return o.useEffect(()=>{t&&d()},[t]),e.jsxs(p,{children:[x&&e.jsxs($,{direction:"row",spacing:2,mb:2,children:[e.jsx(v,{label:"Find by UUID",size:"small",value:c,onChange:g=>u(g.target.value),autoComplete:"off"}),e.jsx(S,{variant:"contained",onClick:()=>d(c),disabled:!c,children:"Search"}),e.jsx(S,{onClick:()=>{u(""),d()},variant:"outlined",disabled:l,children:"Show All"})]}),s&&e.jsx(D,{severity:"error",sx:{mb:2},children:s}),l?e.jsx(p,{textAlign:"center",mt:2,children:e.jsx(V,{})}):e.jsx(ct,{agreements:r})]})}function ut({agreements:t,onEdit:r,onDelete:i,onReload:l}){const[n,s]=o.useState(0),[a,c]=o.useState(10),[u,x]=o.useState(""),[d,m]=o.useState(""),g=o.useMemo(()=>{if(!u.trim())return t;const h=u.toLowerCase();return t.filter(k=>{const N=k.uuid.toLowerCase().includes(h),A=k.persons.some(W=>`${W.firstName} ${W.lastName}`.toLowerCase().includes(h));return N||A})},[t,u]),b=async h=>{if(window.confirm("Delete this agreement?")){m("");try{const k=await fetch(`/api/admin/agreements/${h}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(k.ok)l();else{const N=await k.json();m(N.message||"Delete failed")}}catch{m("Network error")}}},y=(h,k)=>s(k),C=h=>{c(parseInt(h.target.value,10)),s(0)};return e.jsxs(e.Fragment,{children:[e.jsxs($,{direction:"row",justifyContent:"space-between",p:2,children:[e.jsx(v,{label:"Search by UUID or person name",variant:"outlined",size:"small",value:u,onChange:h=>x(h.target.value)}),d&&e.jsx(j,{color:"error",children:d})]}),e.jsx(ne,{component:J,children:e.jsxs(ae,{size:"small",children:[e.jsx(Ae,{children:e.jsxs(F,{children:[e.jsx(f,{children:"UUID"}),e.jsx(f,{children:"Date From"}),e.jsx(f,{children:"Date To"}),e.jsx(f,{children:"Persons"}),e.jsx(f,{children:"Countries"}),e.jsx(f,{children:"Risks"}),e.jsx(f,{align:"right",children:"Actions"})]})}),e.jsxs(oe,{children:[g.slice(n*a,n*a+a).map(h=>e.jsxs(F,{hover:!0,children:[e.jsx(f,{children:h.uuid}),e.jsx(f,{children:new Date(h.agreementDateFrom).toLocaleDateString()}),e.jsx(f,{children:new Date(h.agreementDateTo).toLocaleDateString()}),e.jsx(f,{children:h.persons.map(k=>`${k.firstName} ${k.lastName}`).join(", ")}),e.jsx(f,{children:h.countriesToVisit.join(", ")}),e.jsx(f,{children:h.selectedRisks.join(", ")}),e.jsxs(f,{align:"right",children:[e.jsx(X,{title:"Edit",children:e.jsx(_,{size:"small",onClick:()=>r(h),children:e.jsx(Oe,{})})}),e.jsx(X,{title:"Delete",children:e.jsx(_,{size:"small",color:"error",onClick:()=>b(h.uuid),children:e.jsx(ie,{})})})]})]},h.uuid)),g.length===0&&e.jsx(F,{children:e.jsx(f,{colSpan:7,align:"center",children:"No agreements found"})})]})]})}),e.jsx(Pe,{component:"div",count:g.length,rowsPerPage:a,page:n,onPageChange:y,onRowsPerPageChange:C,rowsPerPageOptions:[5,10,25]})]})}function ht({open:t,agreement:r,onClose:i,onSave:l}){const[n,s]=o.useState({agreementDateFrom:"",agreementDateTo:"",countriesToVisit:"",insuranceLimit:"",agreementPremium:"",selectedRisks:""}),[a,c]=o.useState(""),[u,x]=o.useState(!1);o.useEffect(()=>{r&&s({agreementDateFrom:r.agreementDateFrom||"",agreementDateTo:r.agreementDateTo||"",countriesToVisit:r.countriesToVisit.join(", ")||"",insuranceLimit:r.insuranceLimit||"",agreementPremium:r.agreementPremium||"",selectedRisks:r.selectedRisks.join(", ")||""})},[r]);const d=g=>{const{name:b,value:y}=g.target;s(C=>({...C,[b]:y}))},m=async g=>{g.preventDefault(),c(""),x(!0);try{const b=h=>h&&(h.length===16?h+":00":h),y={agreement:{agreementDateFrom:b(n.agreementDateFrom),agreementDateTo:b(n.agreementDateTo),countriesToVisit:n.countriesToVisit.split(",").map(h=>h.trim()).filter(Boolean),insuranceLimit:Number(n.insuranceLimit),agreementPremium:Number(n.agreementPremium),selectedRisks:n.selectedRisks.split(",").map(h=>h.trim()).filter(Boolean)}},C=await fetch(`/api/admin/agreements/${r.uuid}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(y)});if(C.ok){const h=await C.json();l(h.data)}else{const h=await C.json();c(h.message||"Failed to save agreement")}}catch{c("Network error")}finally{x(!1)}};return e.jsxs(ue,{open:t,onClose:i,maxWidth:"sm",fullWidth:!0,children:[e.jsx(he,{children:"Edit Agreement"}),e.jsxs(me,{children:[a&&e.jsx(D,{severity:"error",sx:{mb:2},children:a}),e.jsx("form",{id:"edit-agreement-form",onSubmit:m,children:e.jsxs($,{spacing:2,children:[e.jsx(v,{label:"Date From",name:"agreementDateFrom",type:"datetime-local",value:n.agreementDateFrom,onChange:d,InputLabelProps:{shrink:!0},required:!0}),e.jsx(v,{label:"Date To",name:"agreementDateTo",type:"datetime-local",value:n.agreementDateTo,onChange:d,InputLabelProps:{shrink:!0},required:!0}),e.jsx(v,{label:"Countries to Visit (comma separated)",name:"countriesToVisit",value:n.countriesToVisit,onChange:d}),e.jsx(v,{label:"Insurance Limit",name:"insuranceLimit",type:"number",value:n.insuranceLimit,onChange:d}),e.jsx(v,{label:"Agreement Premium",name:"agreementPremium",type:"number",value:n.agreementPremium,onChange:d}),e.jsx(v,{label:"Selected Risks (comma separated)",name:"selectedRisks",value:n.selectedRisks,onChange:d})]})})]}),e.jsxs(xe,{children:[e.jsx(S,{onClick:i,disabled:u,children:"Cancel"}),e.jsx(S,{form:"edit-agreement-form",type:"submit",variant:"contained",disabled:u,children:u?"Saving...":"Save"})]})]})}function mt(){const[t,r]=o.useState([]),[i,l]=o.useState(!1),[n,s]=o.useState(""),[a,c]=o.useState(0),[u,x]=o.useState(null);o.useEffect(()=>{d()},[]);const d=async()=>{l(!0),s("");try{const g=await fetch("/api/agreement/all",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),b=await g.json();g.ok?r(b.data||[]):s(b.message||"Failed to load agreements")}catch{s("Network error loading agreements")}finally{l(!1)}},m=g=>{r(b=>b.map(y=>y.uuid===g.uuid?g:y)),x(null)};return e.jsxs(p,{sx:{maxWidth:900,mx:"auto",mt:4,p:3,bgcolor:"background.paper",borderRadius:2,boxShadow:3},children:[e.jsx(j,{variant:"h4",mb:3,children:"Admin Agreements"}),n&&e.jsx(D,{severity:"error",mb:2,children:n}),i?e.jsxs(p,{textAlign:"center",children:[e.jsx(V,{}),e.jsx(j,{mt:2,children:"Loading agreements..."})]}):e.jsx(J,{children:e.jsx(ut,{agreements:t,onEdit:x,onReload:d})}),u&&e.jsx(ht,{open:!!u,agreement:u,onClose:()=>x(null),onSave:m})]})}function xt({users:t,onEdit:r,onUserChange:i,onReload:l}){const[n,s]=o.useState(0),[a,c]=o.useState(10),[u,x]=o.useState(""),[d,m]=o.useState(null),[g,b]=o.useState(!1),[y,C]=o.useState(""),{user:h}=B(),k=o.useMemo(()=>{if(!u.trim())return t;const w=u.toLowerCase();return t.filter(T=>T.firstName.toLowerCase().includes(w)||T.lastName.toLowerCase().includes(w)||T.email.toLowerCase().includes(w))},[t,u]),N=async w=>{if(window.confirm("Delete this user?")){b(!0),C("");try{const T=await fetch(`/api/admin/users/${w}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"X-User-Email":(h==null?void 0:h.email)||""}});if(T.ok)l();else{const q=await T.json();C(q.message||"Delete failed")}}catch{C("Network error")}finally{b(!1)}}},A=async(w,T)=>{try{const q=await fetch(`/api/admin/users/${w}/blacklist?blacklisted=${T}`,{method:"PUT",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(q.ok)i({...t.find(G=>G.personCode===w),blackListed:T});else{const G=await q.json();C(G.message||"Failed to update blacklist")}}catch{C("Network error")}},W=(w,T)=>s(T),Q=w=>{c(parseInt(w.target.value,10)),s(0)};return e.jsxs(e.Fragment,{children:[e.jsxs($,{direction:"row",justifyContent:"space-between",p:2,children:[e.jsx(v,{label:"Search by name or email",variant:"outlined",size:"small",value:u,onChange:w=>x(w.target.value)}),y&&e.jsx(j,{color:"error",children:y})]}),e.jsx(ne,{children:e.jsxs(ae,{size:"small",children:[e.jsx(Ae,{children:e.jsxs(F,{children:[e.jsx(f,{children:"Person Code"}),e.jsx(f,{children:"Full Name"}),e.jsx(f,{children:"Email"}),e.jsx(f,{children:"Roles"}),e.jsx(f,{children:"Blacklisted"}),e.jsx(f,{align:"right",children:"Actions"})]})}),e.jsxs(oe,{children:[k.slice(n*a,n*a+a).map(w=>e.jsxs(F,{hover:!0,children:[e.jsx(f,{children:w.personCode}),e.jsxs(f,{children:[w.firstName," ",w.lastName]}),e.jsx(f,{children:w.email}),e.jsx(f,{children:Array.from(w.roles).join(", ")}),e.jsx(f,{children:e.jsx(ze,{checked:w.blackListed,onChange:T=>A(w.personCode,T.target.checked),color:"error"})}),e.jsxs(f,{align:"right",children:[e.jsx(X,{title:"Edit",children:e.jsx(_,{size:"small",onClick:()=>r(w),children:"âœï¸"})}),e.jsx(X,{title:"Delete",children:e.jsx(_,{size:"small",color:"error",disabled:g,onClick:()=>N(w.personCode),children:e.jsx(ie,{})})})]})]},w.personCode)),k.length===0&&e.jsx(F,{children:e.jsx(f,{colSpan:6,align:"center",children:"No users found"})})]})]})}),e.jsx(Pe,{rowsPerPageOptions:[5,10,25],component:"div",count:k.length,rowsPerPage:a,page:n,onPageChange:W,onRowsPerPageChange:Q})]})}function gt({open:t,onClose:r,user:i,onSave:l}){const[n,s]=o.useState({firstName:"",lastName:"",email:"",personCode:"",blackListed:!1,roles:new Set}),[a,c]=o.useState(""),[u,x]=o.useState(!1);o.useEffect(()=>{i&&s({firstName:i.firstName||"",lastName:i.lastName||"",email:i.email||"",personCode:i.personCode||"",blackListed:i.blackListed||!1,roles:new Set(i.roles||[])})},[i]);const d=["ROLE_USER","ROLE_ADMIN"],m=y=>{const{name:C,value:h}=y.target;s(k=>({...k,[C]:h}))},g=y=>{s(C=>{const h=new Set(C.roles);return h.has(y)?h.delete(y):h.add(y),{...C,roles:h}})},b=async y=>{y.preventDefault(),c(""),x(!0);try{const C={firstName:n.firstName,lastName:n.lastName,email:n.email,blackListed:n.blackListed,roles:Array.from(n.roles)},h=await fetch(`/api/admin/users/${i.personCode}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(C)});if(h.ok){const k=await h.json();l(k)}else{const k=await h.json();c(k.message||"Failed to update user")}}catch{c("Network error")}finally{x(!1)}};return e.jsxs(ue,{open:t,onClose:r,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(he,{children:["Edit User ",n.firstName," ",n.lastName]}),e.jsxs(me,{children:[a&&e.jsx(D,{severity:"error",sx:{mb:2},children:a}),e.jsxs("form",{id:"edit-user-form",onSubmit:b,children:[e.jsx(v,{label:"First Name",name:"firstName",value:n.firstName,onChange:m,fullWidth:!0,margin:"normal",required:!0}),e.jsx(v,{label:"Last Name",name:"lastName",value:n.lastName,onChange:m,fullWidth:!0,margin:"normal",required:!0}),e.jsx(v,{label:"Email",name:"email",type:"email",value:n.email,onChange:m,fullWidth:!0,margin:"normal",required:!0}),e.jsx(v,{label:"Person Code",name:"personCode",value:n.personCode,disabled:!0,fullWidth:!0,margin:"normal"}),e.jsx($e,{sx:{mt:2},children:e.jsx(pe,{control:e.jsx(fe,{checked:n.blackListed,onChange:y=>s(C=>({...C,blackListed:y.target.checked}))}),label:"Blacklisted"})}),e.jsx(j,{sx:{mt:2,mb:1},children:"Roles:"}),e.jsx($,{direction:"row",spacing:2,children:d.map(y=>e.jsx(pe,{control:e.jsx(fe,{checked:n.roles.has(y),onChange:()=>g(y)}),label:y.replace("ROLE_","")},y))})]})]}),e.jsxs(xe,{children:[e.jsx(S,{onClick:r,disabled:u,children:"Cancel"}),e.jsx(S,{form:"edit-user-form",type:"submit",variant:"contained",disabled:u,children:u?"Saving...":"Save"})]})]})}function jt(){const[t,r]=o.useState([]),[i,l]=o.useState(!1),[n,s]=o.useState(""),[a,c]=o.useState(null),u=async()=>{l(!0),s("");try{const d=await fetch("/api/admin/users",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),m=await d.json();d.ok?r(m):s(m.message||"Failed to load users")}catch{s("Network error loading users")}finally{l(!1)}};o.useEffect(()=>{u()},[]);const x=d=>{r(m=>m.map(g=>g.personCode===d.personCode?d:g)),c(null)};return e.jsxs(p,{sx:{maxWidth:900,mx:"auto",mt:4,p:3,bgcolor:"background.paper",borderRadius:2,boxShadow:3},children:[e.jsx(j,{variant:"h4",mb:3,children:"Admin Users"}),n&&e.jsx(D,{severity:"error",mb:2,children:n}),i?e.jsx(V,{}):e.jsx(J,{children:e.jsx(xt,{users:t,onEdit:c,onUserChange:d=>{r(m=>m.map(g=>g.personCode===d.personCode?d:g))},onReload:u})}),a&&e.jsx(gt,{open:!!a,user:a,onClose:()=>c(null),onSave:x})]})}function pt(){const{user:t,logout:r}=B(),[i,l]=o.useState(null),[n,s]=o.useState(""),[a,c]=o.useState(!1),[u,x]=o.useState(!1),[d,m]=o.useState(!1),[g,b]=o.useState(0),y=z(),C=async()=>{c(!0),s("");try{const N=await fetch("/api/auth/me",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),A=await N.json();N.ok?l(A.data):s(A.message||"Failed to load user data")}catch{s("Network error loading user data")}finally{c(!1)}};o.useEffect(()=>{t&&C()},[t]);const h=async N=>{if(s(""),!N){s("Please enter your password");return}try{const A=await fetch("/api/auth/delete",{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({password:N})});if(A.ok)x(!0),r(),setTimeout(()=>y("/auth?type=login"),3e3);else{const W=await A.json();s(W.message||"Failed to delete profile")}}catch{s("Network error deleting profile")}};return t?u?e.jsx(p,{mt:6,textAlign:"center",children:e.jsx(D,{severity:"success",children:"Profile deleted successfully. Redirecting to login..."})}):t.roles&&t.roles.some(N=>N==="ROLE_ADMIN")?e.jsxs(e.Fragment,{children:[e.jsxs(be,{value:g,onChange:(N,A)=>b(A),sx:{mb:3},"aria-label":"Admin Tabs",children:[e.jsx(ee,{label:"Agreements"}),e.jsx(ee,{label:"Users"})]}),g===0&&e.jsx(mt,{}),g===1&&e.jsx(jt,{})]}):e.jsxs(p,{maxWidth:700,mx:"auto",mt:4,p:3,bgcolor:"background.paper",borderRadius:2,boxShadow:3,children:[e.jsxs(be,{value:g,onChange:(N,A)=>b(A),sx:{mb:3},"aria-label":"Profile and Agreements Tabs",children:[e.jsx(ee,{label:"Profile"}),e.jsx(ee,{label:"Agreements"})]}),g===0&&e.jsx(lt,{userData:i,loadingUser:a,error:n}),g===1&&e.jsx(dt,{}),e.jsxs(p,{mt:4,children:[e.jsx(S,{color:"error",variant:"outlined",fullWidth:!0,onClick:()=>m(!0),children:"Delete Profile"}),e.jsx(ot,{open:d,onClose:()=>m(!1),onConfirm:h,error:n})]})]}):e.jsx(p,{mt:6,textAlign:"center",children:e.jsx(j,{variant:"h6",children:"Please login to view your profile"})})}const De=[{code:"SPAIN",name:"Spain",flag:"https://flagcdn.com/w320/es.png",capital:"Madrid",population:47e6,languages:["Spanish"],currency:"EUR",advisory:"Be cautious of pickpockets in tourist areas.",requirements:["Travel insurance mandatory","Visa-free for EU citizens"]},{code:"USA",name:"USA",flag:"https://flagcdn.com/w320/us.png",capital:"Washington, D.C.",population:331e6,languages:["English"],currency:"USD",advisory:"Check local laws and customs carefully.",requirements:["Travel insurance recommended","Visa required for many countries"]},{code:"JAPAN",name:"Japan",flag:"https://flagcdn.com/w320/jp.png",capital:"Tokyo",population:126e6,languages:["Japanese"],currency:"JPY",advisory:"Respect local traditions and etiquette.",requirements:["Travel insurance recommended","Visa waiver for many countries"]},{code:"LATVIA",name:"Latvia",flag:"https://flagcdn.com/w320/lv.png",capital:"Riga",population:19e5,languages:["Latvian"],currency:"EUR",advisory:"Safe country with mild climate.",requirements:["Travel insurance recommended","Visa-free for EU citizens"]}];function ft({onSelectCountry:t}){const[r,i]=o.useState(null);return e.jsxs(p,{sx:{maxWidth:900,mx:"auto",p:2},children:[e.jsx(j,{variant:"h4",mb:2,textAlign:"center",children:"Explore Countries"}),e.jsx(p,{sx:{display:"flex",overflowX:"auto",gap:2,pb:1,"&::-webkit-scrollbar":{height:8},"&::-webkit-scrollbar-thumb":{backgroundColor:"#ccc",borderRadius:4},scrollbarWidth:"thin",scrollbarColor:"#ccc transparent"},children:De.map(l=>e.jsx(Z,{sx:{minWidth:160,flexShrink:0,cursor:"pointer",border:r===l.code?"2px solid #1976d2":"1px solid #ddd",boxShadow:r===l.code?6:1,transition:"border-color 0.3s, box-shadow 0.3s"},onClick:()=>t(l),onMouseEnter:()=>i(l.code),onMouseLeave:()=>i(null),title:`Click to view details about ${l.name}`,children:e.jsxs(Ve,{children:[e.jsx(qe,{component:"img",height:"100",image:l.flag,alt:`Flag of ${l.name}`,sx:{objectFit:"contain",p:1}}),e.jsx(H,{children:e.jsx(j,{variant:"subtitle1",noWrap:!0,children:l.name})})]})},l.code))})]})}function bt({country:t,onBack:r}){return e.jsx(p,{display:"flex",justifyContent:"center",p:2,bgcolor:"#f9f9f9",minHeight:"100vh",children:e.jsx(Z,{sx:{maxWidth:600,width:"100%"},children:e.jsxs(H,{children:[e.jsx(j,{variant:"h4",gutterBottom:!0,children:t.name}),e.jsx(p,{component:"img",src:t.flag,alt:`Flag of ${t.name}`,sx:{width:"100%",maxHeight:200,objectFit:"contain",mb:2}}),e.jsxs(j,{variant:"body1",children:[e.jsx("strong",{children:"Capital:"})," ",t.capital]}),e.jsxs(j,{variant:"body1",children:[e.jsx("strong",{children:"Population:"})," ",t.population.toLocaleString()]}),e.jsxs(j,{variant:"body1",children:[e.jsx("strong",{children:"Language:"})," ",t.languages.join(", ")]}),e.jsxs(j,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Currency:"})," ",t.currency]}),e.jsx(j,{variant:"h6",mt:3,children:"Travel Advisory:"}),e.jsx(j,{variant:"body2",mb:3,children:t.advisory}),e.jsx(j,{variant:"h6",children:"Insurance Requirements:"}),e.jsx(ke,{dense:!0,children:t.requirements.map((i,l)=>e.jsx(Me,{sx:{pl:0},children:e.jsx(_e,{primary:i})},l))})]})})})}function Se(){const[t,r]=o.useState([]),[i,l]=o.useState(!0),[n,s]=o.useState(""),{countryCode:a}=He(),c=z();if(o.useEffect(()=>{(async()=>{l(!0),s("");try{r(De)}catch{s("Network error. Please try again.")}finally{l(!1)}})()},[]),i)return e.jsxs(p,{className:"container",textAlign:"center",mt:4,children:[e.jsx(V,{}),e.jsx(j,{mt:2,children:"Loading countries..."})]});if(n)return e.jsx(p,{className:"container",mt:4,children:e.jsx(D,{severity:"error",children:n})});if(a){const u=t.find(x=>x.code===a);return u?e.jsxs(p,{className:"container",sx:{maxWidth:900,mx:"auto",p:2},children:[e.jsx(S,{variant:"outlined",onClick:()=>c("/countries"),sx:{mb:2},children:"â† Back to countries"}),e.jsx(bt,{country:u})]}):e.jsxs(p,{className:"container",mt:4,children:[e.jsx(D,{severity:"error",children:"Country not found"}),e.jsx(S,{onClick:()=>c("/countries"),sx:{mt:2},children:"Back to countries list"})]})}return e.jsx(p,{className:"container",sx:{maxWidth:900,mx:"auto",p:2},children:e.jsx(ft,{countries:t,onSelectCountry:u=>c(`/countries/${u.code}`)})})}const yt=[{value:"USA",label:"UNITED STATES"},{value:"SPAIN",label:"SPAIN"},{value:"JAPAN",label:"JAPAN"},{value:"LATVIA",label:"LATVIA"}];function vt({countries:t,onAdd:r,onChange:i,onRemove:l}){return e.jsxs(p,{mb:4,children:[e.jsx(j,{variant:"h5",mb:2,children:"Countries to Visit"}),t.map((n,s)=>e.jsxs(p,{display:"flex",alignItems:"center",mb:2,gap:1,children:[e.jsxs(te,{fullWidth:!0,children:[e.jsxs(re,{id:`country-label-${s}`,children:["Country ",s+1]}),e.jsxs(se,{labelId:`country-label-${s}`,id:`country${s}`,value:n,label:`Country ${s+1}`,onChange:a=>i(s,a.target.value),children:[e.jsx(I,{value:"",children:e.jsx("em",{children:"-- Select Country --"})}),yt.map(a=>e.jsx(I,{value:a.value,children:a.label},a.value))]})]}),t.length>1&&e.jsx(_,{"aria-label":`Remove country ${s+1}`,onClick:()=>l(s),color:"error",children:e.jsx(ie,{})})]},s)),e.jsx(S,{variant:"outlined",startIcon:e.jsx(Je,{}),onClick:r,children:"Add Country"})]})}function Ct({from:t,to:r,onFromChange:i,onToChange:l}){return e.jsxs(p,{mb:4,children:[e.jsx(j,{variant:"h5",mb:2,children:"Agreement Dates"}),e.jsx(p,{display:"flex",gap:2,flexWrap:"wrap",children:[{label:"Agreement Date From",value:t,onChange:i},{label:"Agreement Date To",value:r,onChange:l}].map(({label:n,value:s,onChange:a})=>e.jsx(v,{label:n,type:"datetime-local",value:s,onChange:a,InputLabelProps:{shrink:!0},sx:{flex:1,minWidth:220,backgroundColor:"white",borderRadius:1,boxShadow:1,"& .MuiOutlinedInput-root":{"&.Mui-focused fieldset":{borderColor:"primary.main",boxShadow:"0 0 0 2px rgba(25,118,210,0.3)"}}},InputProps:{sx:{"&::-webkit-calendar-picker-indicator":{cursor:"pointer",filter:"invert(0.4) brightness(1.2)",transition:"filter 0.3s ease","&:hover":{filter:"invert(0) brightness(1.5)"}},"&::-moz-focus-inner":{border:0}}}},n))})]})}function St({persons:t,onChange:r,onAddPerson:i,onRemovePerson:l}){return e.jsxs(p,{mb:4,children:[e.jsx(j,{variant:"h5",mb:2,children:"Person Details"}),t.map((n,s)=>e.jsxs(p,{mb:3,p:2,border:"1px solid #ccc",borderRadius:2,position:"relative",children:[e.jsxs(j,{variant:"h6",mb:2,children:["Person ",s+1]}),e.jsx(v,{label:"First Name",value:n.firstName,onChange:a=>r(s,"firstName",a.target.value),fullWidth:!0,required:!0,sx:{mb:2}}),e.jsx(v,{label:"Last Name",value:n.lastName,onChange:a=>r(s,"lastName",a.target.value),fullWidth:!0,required:!0,sx:{mb:2}}),e.jsx(v,{label:"Birth Date",type:"date",value:n.birthDate,onChange:a=>r(s,"birthDate",a.target.value),fullWidth:!0,required:!0,InputLabelProps:{shrink:!0}}),t.length>1&&e.jsx(_,{"aria-label":`Remove person ${s+1}`,onClick:()=>l(s),color:"error",sx:{position:"absolute",top:8,right:8},children:e.jsx(ie,{})})]},s)),e.jsx(S,{variant:"outlined",onClick:i,children:"Add Person"})]})}const wt=[{value:"TRAVEL_MEDICAL",label:"Travel Medical"},{value:"TRAVEL_THIRD_PARTY_LIABILITY",label:"Third Party Liability"},{value:"TRAVEL_EVACUATION",label:"Evacuation"},{value:"TRAVEL_CANCELLATION",label:"Cancellation"},{value:"TRAVEL_LOSS_BAGGAGE",label:"Loss of Baggage"},{value:"TRAVEL_SPORT_ACTIVITIES",label:"Sport Activities"}];function kt({insuranceLimit:t,onLimitChange:r,selectedRisks:i,onRisksChange:l}){return e.jsxs(p,{mb:4,children:[e.jsxs(te,{fullWidth:!0,sx:{mb:3},children:[e.jsx(re,{id:"insurance-limit-label",children:"Insurance Limit"}),e.jsxs(se,{labelId:"insurance-limit-label",id:"insuranceLimit",value:t,label:"Insurance Limit",onChange:r,children:[e.jsx(I,{value:"10000",children:"10,000 EUR"}),e.jsx(I,{value:"15000",children:"15,000 EUR"}),e.jsx(I,{value:"20000",children:"20,000 EUR"}),e.jsx(I,{value:"25000",children:"25,000 EUR"})]})]}),e.jsx(j,{variant:"h5",mb:2,children:"Risks"}),e.jsxs(te,{fullWidth:!0,children:[e.jsx(re,{id:"risks-label",children:"Select Risk"}),e.jsxs(se,{labelId:"risks-label",id:"selectedRisks",value:i[0]||"",label:"Select Risk",onChange:l,children:[e.jsx(I,{value:"",children:e.jsx("em",{children:"-- Select Risk --"})}),wt.map(n=>e.jsx(I,{value:n.value,children:n.label},n.value))]})]})]})}function de({data:t,level:r=0}){const[i,l]=o.useState({}),n=s=>{l(a=>({...a,[s]:!a[s]}))};if(t==null)return e.jsxs(F,{children:[e.jsx(f,{sx:{pl:2*r,fontStyle:"italic",color:"text.disabled"},children:"null"}),e.jsx(f,{})]});if(typeof t!="object"){const s=String(t),a=s.length>50;return e.jsxs(F,{children:[e.jsx(f,{sx:{pl:2*r},children:a?e.jsx(X,{title:s,children:e.jsx(j,{noWrap:!0,sx:{maxWidth:300},children:s})}):s}),e.jsx(f,{})]})}return Array.isArray(t)?t.length===0?e.jsxs(F,{children:[e.jsx(f,{sx:{pl:2*r,fontStyle:"italic",color:"text.disabled"},children:"(empty array)"}),e.jsx(f,{})]}):e.jsx(e.Fragment,{children:t.map((s,a)=>e.jsxs(ye.Fragment,{children:[e.jsx(F,{children:e.jsxs(f,{sx:{pl:2*r,fontWeight:"bold",cursor:"pointer"},onClick:()=>n(a),children:[i[a]?e.jsx(ve,{fontSize:"small"}):e.jsx(Ce,{fontSize:"small"})," [",a,"]"]})}),!i[a]&&e.jsx(de,{data:s,level:r+1})]},a))}):e.jsx(e.Fragment,{children:Object.entries(t).map(([s,a])=>{const c=i[s]||!1,u=a&&typeof a=="object";return e.jsx(ye.Fragment,{children:e.jsxs(F,{children:[e.jsxs(f,{sx:{pl:2*r,fontWeight:"bold",cursor:u?"pointer":"default",userSelect:"none",display:"flex",alignItems:"center",gap:.5},onClick:()=>u&&n(s),children:[u?c?e.jsx(ve,{fontSize:"small"}):e.jsx(Ce,{fontSize:"small"}):null,s]}),u?e.jsx(f,{sx:{p:0},children:!c&&e.jsx(ne,{component:J,variant:"outlined",sx:{boxShadow:"none"},children:e.jsx(ae,{size:"small","aria-label":"nested table",children:e.jsx(oe,{children:e.jsx(de,{data:a,level:r+1})})})})}):e.jsx(f,{children:String(a)})]})},s)})})}function At({data:t}){return t?t.errors?e.jsx(p,{mt:4,children:e.jsx(D,{severity:"error",children:t.errors.map((r,i)=>e.jsx("div",{children:r.description||r.errorCode||r.message||"Error"},i))})}):e.jsxs(p,{mt:4,p:3,boxShadow:2,borderRadius:2,bgcolor:"background.paper",children:[e.jsx(j,{variant:"h5",gutterBottom:!0,children:"Response Data"}),e.jsx(ne,{component:J,variant:"outlined",children:e.jsx(ae,{"aria-label":"response data table",size:"small",children:e.jsx(oe,{children:e.jsx(de,{data:t})})})})]}):null}function Pt({onCalculate:t}){const[r,i]=o.useState([""]),[l,n]=o.useState(""),[s,a]=o.useState(""),[c,u]=o.useState([{firstName:"",lastName:"",birthDate:"",personCode:"",roles:[]}]),[x,d]=o.useState("10000"),[m,g]=o.useState(["TRAVEL_MEDICAL"]),[b,y]=o.useState(null),[C,h]=o.useState([]),[k,N]=o.useState(!1),{user:A}=B(),W=z(),Q=Ge(),w=()=>i([...r,""]),T=(P,L)=>{const O=[...r];O[P]=L,i(O)},q=P=>{if(r.length<=1)return;const L=[...r];L.splice(P,1),i(L)},G=(P,L,O)=>{const Y=[...c];Y[P]={...Y[P],[L]:O},u(Y)};o.useEffect(()=>{A&&c.length===1&&!c[0].firstName&&!c[0].lastName&&!c[0].birthDate&&u([{firstName:A.firstName||"",lastName:A.lastName||"",birthDate:A.birthDate||"",personCode:A.personCode||"",roles:A.roles||[]}])},[A]);const Te=()=>u([...c,{firstName:"",lastName:"",birthDate:""}]),Le=P=>{if(c.length<=1)return;const L=[...c];L.splice(P,1),u(L)},Ee=async P=>{if(P.preventDefault(),!A){W("/auth?type=login&redirect=/insurance");return}N(!0),h([]),y(null);try{const L=localStorage.getItem("token"),O=E=>E?E.length===16?`${E}:00`:E:null,Y={agreement:{countriesToVisit:r.filter(Boolean),agreementDateFrom:O(l),agreementDateTo:O(s),persons:c.map(E=>({firstName:E.firstName,lastName:E.lastName,birthDate:E.birthDate,personCode:E.personCode,roles:E.roles})),insuranceLimit:parseInt(x,10),selectedRisks:m}},ge=await fetch("/insurance/travel/web/v3",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${L}`},body:JSON.stringify(Y)}),U=await ge.json();if(ge.ok)y(U),t&&t(U);else{let E=[];if(U.errors&&Array.isArray(U.errors)?E=U.errors:U.data&&Array.isArray(U.data.errors)&&(E=U.data.errors),E.length>0){const Ie=E.map(je=>je.description||je.errorCode||"Unknown error");h(Ie)}else h([U.message||"An error occurred"])}}catch(L){h([L.message])}finally{N(!1)}};return e.jsx(p,{maxWidth:700,mx:"auto",p:{xs:0,sm:3},mt:4,sx:{backgroundColor:"rgba(255,255,255,0.90)",borderRadius:3,boxShadow:6,border:`1px solid ${Q.palette.divider}`},children:e.jsxs(H,{sx:{color:"#222"},children:[e.jsx(j,{variant:"h4",mb:3,textAlign:"center",sx:{color:Q.palette.text.primary,textShadow:"0 2px 6px rgba(0,0,0,0.13)"},children:"Travel Insurance Form"}),e.jsxs("form",{onSubmit:Ee,noValidate:!0,children:[e.jsx(vt,{countries:r,onAdd:w,onChange:T,onRemove:q}),e.jsx(Ct,{from:l,to:s,onFromChange:P=>n(P.target.value),onToChange:P=>a(P.target.value)}),e.jsx(St,{persons:c,onChange:G,onAddPerson:Te,onRemovePerson:Le}),e.jsx(kt,{insuranceLimit:x,onLimitChange:P=>d(P.target.value),selectedRisks:m,onRisksChange:P=>g([P.target.value])}),e.jsxs(p,{display:"flex",gap:2,justifyContent:"center",mt:3,flexWrap:"wrap",children:[e.jsx(S,{type:"submit",variant:"contained",color:"primary",disabled:k||!A,children:k?e.jsx(V,{size:24,color:"inherit"}):"Calculate Premium"}),e.jsx(S,{type:"button",variant:"outlined",color:"secondary",onClick:()=>window.location.reload(),children:"Clear"})]}),!A&&e.jsxs(D,{severity:"warning",sx:{mt:3},children:["You must be logged in to calculate insurance."," ",e.jsx(S,{color:"inherit",size:"small",onClick:()=>W("/auth?type=login"),children:"Login Now"})]}),C.length>0&&e.jsxs(D,{severity:"error",sx:{mt:3},children:[e.jsx(j,{variant:"h6",children:"Errors:"}),C.map((P,L)=>e.jsx("div",{children:P},L))]})]}),b&&e.jsx(At,{data:b})]})})}function Nt(){return e.jsx(Ze,{children:e.jsx(Ye,{children:e.jsx(tt,{children:e.jsxs(Ke,{children:[e.jsx(M,{path:"/",element:e.jsx(rt,{})}),e.jsx(M,{path:"/auth",element:e.jsx(at,{})}),e.jsx(M,{path:"/profile",element:e.jsx(pt,{})}),e.jsx(M,{path:"/countries",element:e.jsx(Se,{})}),e.jsx(M,{path:"/countries/:countryCode",element:e.jsx(Se,{})}),e.jsx(M,{path:"/insurance",element:e.jsx(Pt,{})})]})})})})}Xe.createRoot(document.getElementById("root")).render(e.jsx(o.StrictMode,{children:e.jsx(Nt,{})}));
