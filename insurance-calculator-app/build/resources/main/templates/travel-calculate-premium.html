<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>Travel Insurance Premium Calculation</title>
</head>
<body>

<h1>Travel Insurance Premium Calculation</h1>

<form th:action="@{/insurance/travel/web/v1}" th:object="${request}" method="post">

    <!-- Country selection -->
    <h2>Countries to Visit</h2>
    <div th:each="country, stat : ${request.agreement.countriesToVisit}">
        <label th:for="'country' + ${stat.index}">Country <span th:text="${stat.index + 1}"></span>:</label>
        <select th:id="'country' + ${stat.index}" th:field="*{agreement.countriesToVisit[__${stat.index}__]}">
            <option value="">-- Select Country --</option>
            <option value="USA">UNITED STATES</option>
            <option value="SPAIN">SPAIN</option>
            <option value="JAPAN">JAPAN</option>
            <option value="LATVIA">LATVIA</option>
            <!-- Add more countries as needed -->
        </select>
    </div>

    <!-- Agreement Dates -->
    <h2>Agreement Dates</h2>
    <div>
        <label for="agreementDateFrom">Agreement Date From:</label>
        <input type="datetime-local" id="agreementDateFrom" th:field="*{agreement.agreementDateFrom}"
               th:value="${#temporals.format(request?.agreement?.agreementDateFrom, 'yyyy-MM-dd''T''HH:mm')}"/>
    </div>
    <div>
        <label for="agreementDateTo">Agreement Date To:</label>
        <input type="datetime-local" id="agreementDateTo" th:field="*{agreement.agreementDateTo}"
               th:value="${#temporals.format(request?.agreement?.agreementDateTo, 'yyyy-MM-dd''T''HH:mm')}"/>
    </div>

    <!-- Person Details -->
    <h2>Person Details</h2>
    <div th:if="${request?.agreement?.persons != null}">
        <h3>Person 1</h3>
        <div>
            <label th:for="'personFirstName'">First Name:</label>
            <input type="text" th:id="'personFirstName'"
                   th:field="*{agreement.persons[0].personFirstName}"/>
        </div>
        <div>
            <label th:for="'personLastName'">Last Name:</label>
            <input type="text" th:id="'personLastName'"
                   th:field="*{agreement.persons[0].personLastName}"/>
        </div>
        <div>
            <label th:for="'personBirthDate'">Birth Date:</label>
            <input type="date" th:id="'personBirthDate'"
                   th:field="*{agreement.persons[0].personBirthDate}"/>
        </div>
        <div>
            <label for="insuranceLimit">Insurance Limit:</label>
            <select th:field="*{agreement.insuranceLimit}" id="insuranceLimit">
                <option value="10000">10,000 EUR</option>
                <option value="15000">15,000 EUR</option>
                <option value="20000">20,000 EUR</option>
                <option value="25000">25,000 EUR</option>
            </select>
        </div>
    </div>


    <!-- Risks -->
    <h2>Risks</h2>
    <div>
        <label for="selectedRisks">Risks:</label>
        <select th:field="*{agreement.selectedRisks}" id="selectedRisks">
            <option value="TRAVEL_MEDICAL">-- TRAVEL_MEDICAL --</option>
            <option value="TRAVEL_THIRD_PARTY_LIABILITY">-- TRAVEL_THIRD_PARTY_LIABILITY --</option>
            <option value="TRAVEL_EVACUATION">-- TRAVEL_EVACUATION --</option>
            <option value="TRAVEL_CANCELLATION">-- TRAVEL_CANCELLATION --</option>
            <option value="TRAVEL_LOSS_BAGGAGE">-- TRAVEL_LOSS_BAGGAGE --</option>
            <option value="TRAVEL_SPORT_ACTIVITIES">-- TRAVEL_SPORT_ACTIVITIES --</option>
            </select>
    </div>

    <!-- Submit -->
    <div>
        <button type="submit">Calculate Premium</button>
        <!-- Кнопка Clear -->
        <button type="submit" name="action" value="clear">Clear</button>
    </div>
</form>

<!-- Errors -->
<div th:if="${response != null and response.hasErrors()}">
    <h3>Errors:</h3>
    <div th:each="error : ${response.errors}">
        <p><strong th:text="${error.errorCode}"></strong>: <span th:text="${error.description}"></span></p>
    </div>
</div>

<!-- Response Details -->
<div th:if="${response != null and response.agreement != null}">
    <h3>Agreement Premium: <span th:text="${response.agreement.agreementPremium}"></span></h3>
    <div th:if="${response.agreement.persons != null}" th:each="person : ${response.agreement.persons}">
        <h4>Person: <span
                th:text="${person.personFirstName} + ' ' + ${person.personLastName} + ' ' + ${person.personCode}"></span>
        </h4>
        <div th:if="${person.risks != null}">
            <h5>Risks:</h5>
            <ul>
                <li th:each="risk : ${person.risks}">
                    <span th:text="${risk.riskIc} + ': ' + ${risk.premium}"></span>
                </li>
            </ul>
        </div>
    </div>
</div>

</body>
</html>
